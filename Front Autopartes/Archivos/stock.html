<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="java/script.js" defer></script>
</head>
<body class="stock">
    <div class="sidebar"> 
        <h2>Gestión de Stock</h2>
        <a href="index.html"><span class="icon">🏠</span><span class="texto">Inicio</span></a>
        <a href="autopartes.html"><span class="icon">🔧</span><span class="texto">Autopartes</span></a>
        <a href="clientes.html"><span class="icon">👤</span><span class="texto">Clientes</span></a>
        <a href="facturas.html"><span class="icon">📄</span><span class="texto">Facturas</span></a>
        <a href="stock.html"><span class="icon">📦</span><span class="texto">Stock</span></a>
        <a href="login.html" class="login-link"><span class="icon">🔒</span><span class="texto">Cerrar Sesión</span></a>
    </div>
    <div class="content">
        <h2>Stock de Autopartes</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Motivo de Baja</th>
                    <th>Fecha de Baja</th>
                    <th>Estado</th>
                    <th>Stock</th>
                    <th>Precio</th>
                    <th>Descripción</th>
                    <th>Categoría</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="stockTable">
                <!-- Aquí se cargan las autopartes desde la API -->
            </tbody>
        </table>
    </div>

    <!-- Formulario modal para editar autopartes -->
    <div id="editFormModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeEditForm()">&times;</span>
            <h2>Editar Autoparte</h2>
            <form id="editForm">
                <label for="editMotivoBaja">Motivo de Baja:</label>
                <input type="text" id="editMotivoBaja" name="motivoBaja">
                
                <label for="editFechaBaja">Fecha de Baja:</label>
                <input type="date" id="editFechaBaja" name="fechaBaja">
                
                <label for="editEstado">Estado:</label>
                <input type="text" id="editEstado" name="estado">
                
                <label for="editStock">Stock:</label>
                <input type="number" id="editStock" name="stock">
                
                <label for="editPrecio">Precio:</label>
                <input type="number" id="editPrecio" name="precio" step="0.01">
                
                <label for="editDescripcion">Descripción:</label>
                <input type="text" id="editDescripcion" name="descripcion">
                
                <label for="editCategoria">Categoría:</label>
                <select id="editCategoria" name="categoria">
                    <option value="Motor">Motor</option>
                    <option value="Eléctrico">Eléctrico</option>
                    <option value="Frenos">Frenos</option>
                    <option value="Suspensión">Suspensión</option>
                </select>
                
                <button type="button" onclick="confirmEdit()">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <script>
        // Función para obtener autopartes desde la API y llenar la tabla
        async function fetchAutopartes() {
            try {
                const response = await fetch('https://localhost:7219/api/Autopartes/Todas las autopartes');
                if (!response.ok) {
                    throw new Error('Error al obtener los datos de la API');
                }
                const autopartes = await response.json();
                llenarTabla(autopartes);
            } catch (error) {
                console.error('Error:', error);
                alert('Hubo un problema al cargar las autopartes');
            }
        }

        // Función para llenar la tabla con los datos de las autopartes
        function llenarTabla(autopartes) {
            const tableBody = document.getElementById('stockTable');
            tableBody.innerHTML = ''; // Limpiar la tabla antes de agregar los nuevos datos

            autopartes.forEach((autoparte) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${autoparte.id}</td>
                    <td>${autoparte.motivoBaja || ''}</td>
                    <td>${autoparte.fechaBaja || ''}</td>
                    <td>${autoparte.estado}</td>
                    <td>${autoparte.stock}</td>
                    <td>$${autoparte.precio.toFixed(2)}</td>
                    <td>${autoparte.descripcion}</td>
                    <td>${autoparte.categoria}</td>
                    <td><button onclick="openEditForm(${autoparte.id})">Editar</button></td>
                `;

                tableBody.appendChild(row);
            });
        }

        // Función para abrir el formulario de edición con los valores de la autoparte
        function openEditForm(id) {
            // Aquí harías una llamada para obtener datos específicos de la autoparte si es necesario
            document.getElementById("editFormModal").style.display = "block";
        }

        // Función para cerrar el modal de edición
        function closeEditForm() {
            document.getElementById("editFormModal").style.display = "none";
        }

        function confirmEdit() {
            if (confirm("¿Está seguro de que desea guardar los cambios?")) {
                closeEditForm();
                alert("Cambios guardados exitosamente.");
                // Aquí se puede añadir la lógica para guardar los cambios en la base de datos
            }
        }

        // Llamar a la función para cargar las autopartes al cargar la página
        window.onload = fetchAutopartes;
    </script>
</body>
</html>
